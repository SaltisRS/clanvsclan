# docker-compose.yml

services:
  #backend:
    #container_name: cvc-backend
    #build: ./backend
    #ports:
      #- 8001:8001
    #env_file:
      #- .env
    #networks:
      #- cvc-network
      #- vps
    #depends_on:
      #- mongodb

  #discord:
    #container_name: cvc-discord
    #build: ./discordbot
    #env_file:
      #- .env
    #networks:
      #- cvc-network
      #- vps
    #depends_on:
      #- mongodb

  #web:
    #container_name: cvc-web
    #build: ./web
    #ports:
      #- "8000:3000"
    #networks:
      #- cvc-network
      #- vps


  mongodb:
    image: mongo:latest
    container_name: mongodb
    restart: always
    environment: 
      MONGO_INITDB_ROOT_USERNAME: ${MONGO_ROOT_USERNAME}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGO_ROOT_PASSWORD}
    volumes:
      - mongodb_data:/data/db 
    networks:
      - traefik-shared
    labels:
      - "traefik.enable=true"
      - "traefik.tcp.routers.db.rule=HostSNI(`db.ironfoundry.cc`)"
      - "traefik.tcp.routers.db.entrypoints=mongodb"
      - "traefik.tcp.routers.db.service=db"
      - "traefik.tcp.routers.db.tls=true"
      - "traefik.tcp.routers.db.tls.passthrough=true"
      - "traefik.tcp.routers.db.tls.certresolver=cloudflare"
      - "traefik.tcp.services.db.loadbalancer.server.port=27017"

networks:
  traefik-shared:
    external: true

volumes:
  mongodb_data:
    driver: local